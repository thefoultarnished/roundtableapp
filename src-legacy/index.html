<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roundtable Messenger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@300;400;500;600&family=Lato:wght@300;400;700&family=Montserrat:wght@300;400;500;600&family=Open+Sans:wght@300;400;500;600&family=Roboto+Mono:wght@400&family=Roboto:wght@300;400;500;700&family=Space+Grotesk:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body class="bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 h-screen antialiased overflow-hidden">
    <div class="particles" id="particles-container"></div>

    <!-- Title bar with window controls -->
    <div data-tauri-drag-region class="titlebar">
        <div class="flex items-center gap-4">
            <div class="relative pr-2">
                <h1 class="non-scalable text-lg font-bold bg-gradient-to-r from-teal-400 to-blue-500 bg-clip-text text-transparent">Roundtable</h1>    
            </div>
        </div>

        <!-- Search conversations in title bar -->
        <div id="titlebar-search-container" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
            <div class="relative">
                <input type="text" placeholder="search conversations.."
                       class="w-50 h-5 text-sm bg-black/10 dark:bg-white/5 border border-white/10 rounded-md pl-7 pr-2 text-slate-700 dark:text-slate-300 placeholder:text-slate-500 focus:outline-none focus:ring-1 focus:ring-teal-500/80 transition-all duration-300">
                <svg class="absolute left-2 top-1/2 -translate-y-1/3 h-4 w-4 text-slate-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <!-- Theme toggle -->
            <label class="relative inline-flex items-center cursor-pointer group modern-toggle" title="Toggle Theme">
                <input type="checkbox" id="theme-toggle" class="sr-only peer">
                <div class="toggle-track w-[32px] h-[16px] bg-gradient-to-br from-slate-200 to-white dark:from-slate-700 dark:to-slate-800 rounded-full peer-focus:outline-none peer-checked:bg-gradient-to-br peer-checked:from-sky-400 peer-checked:to-sky-500 dark:peer-checked:from-sky-700 dark:peer-checked:to-sky-900 transition-all duration-500 ease-out shadow-inner">
                    <div class="toggle-thumb absolute top-[1.2px] left-[1.2px] bg-gradient-to-br from-white to-slate-50 dark:from-slate-800 dark:to-slate-900 rounded-full h-[13.6px] w-[13.6px] flex items-center justify-center transition-all duration-500 ease-out shadow-lg peer-checked:translate-x-[16px] dark:peer-checked:shadow-sky-500/20">
                        <svg class="sun-icon h-[7.2px] w-[7.2px] text-amber-500 transition-all duration-400 ease-out" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
                        </svg>
                        <svg class="moon-icon absolute h-[7.2px] w-[7.2px] text-slate-300 transition-all duration-400 ease-out" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                        </svg>
                    </div>
                </div>
            </label>

            <!-- Window control buttons -->
            <div class="window-controls">
                <button class="window-btn minimize" id="titlebar-minimize"></button>
                <button class="window-btn maximize" id="titlebar-maximize"></button>
                <button class="window-btn close" id="titlebar-close"></button>
            </div>
        </div>
    </div>

    <div class="flex h-screen pt-8">
        <!-- Sidebar with user list -->
        <aside id="user-list-container" class="bg-slate-50/80 dark:bg-slate-900/80 backdrop-blur-xl m-2 mr-0 rounded-xl shadow-2xl flex flex-col flex-shrink-0 z-10 min-w-[250px] w-[320px] max-w-[500px] border border-slate-200/50 dark:border-slate-800/50">
            <div id="sidebar-status" class="px-4 pt-3 pb-2 text-sm font-medium text-slate-600 dark:text-slate-300"></div>
            
            <!-- User search -->
            <div class="p-3 border-b border-slate-200/50 dark:border-slate-700/50 flex-shrink-0">
                <div class="relative">
                    <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400 pointer-events-none" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text" id="user-search-input" placeholder="Search users..." 
                           class="w-full pl-10 pr-10 py-1.5 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:border-teal-500 focus:ring-2 focus:ring-teal-500/30 outline-none transition-all duration-300 placeholder-slate-400 text-slate-900 dark:text-slate-100">
                    <div class="absolute right-2 top-1/2 -translate-y-1/2">
                        <button id="refresh-users" class="p-1.5 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-200/50 dark:hover:bg-slate-700/50 transition-colors" title="Refresh user list">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- User list populated by JavaScript -->
            <div id="user-list" class="flex-grow overflow-y-auto p-2"></div>

            <!-- Current user profile footer -->
            <div id="my-user-profile-footer" class="p-3 border-t border-slate-200/50 dark:border-slate-700/50 mt-auto">
                <div class="flex items-center gap-3">
                    <div class="relative flex-shrink-0">
                        <img id="footer-pfp-img" src="" class="w-10 h-10 rounded-full object-cover shadow-lg hidden">
                        <div id="footer-pfp-initial" class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center font-bold text-white text-lg shadow-lg">
                        </div>
                    </div>
                    <div class="flex-grow overflow-hidden min-w-0">
                        <p class="text-xs text-slate-500 dark:text-slate-400">Welcome,</p>
                        <p id="footer-username" class="text-xs font-semibold text-slate-900 dark:text-slate-100 truncate">Loading...</p>
                    </div>
                    <button id="footer-settings-btn" title="Open Settings" class="text-slate-500 hover:text-purple-500 dark:hover:text-purple-400 transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Resizable divider for sidebar -->
        <div id="resize-handle" class="w-2 cursor-col-resize bg-transparent flex items-center justify-center group relative" title="Drag to resize sidebar"></div>

        <!-- Main chat area -->
        <main id="chat-container" class="flex-grow flex flex-col m-2 ml-0 animated-gradient-bg rounded-xl shadow-2xl z-10 min-w-[400px] border border-slate-200/50 dark:border-slate-800/50">
            <!-- Welcome screen shown when no chat is selected -->
            <div id="welcome-screen" class="flex flex-col items-center justify-center h-full text-slate-500 dark:text-slate-400/80 p-8 text-center">
                <div class="relative">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 mb-6 opacity-30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 18a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2"/>
                        <rect width="18" height="18" x="3" y="4" rx="2"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                    <div class="absolute inset-0 w-32 h-32 bg-gradient-to-r from-teal-400/20 to-blue-500/20 blur-3xl"></div>
                </div>
                <h2 class="text-3xl font-medium bg-gradient-to-r from-slate-800 to-slate-950 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent mb-2">Welcome to Roundtable</h2>
                <p class="text-lg text-slate-600 dark:text-slate-400">Select a user from the list to begin a conversation</p>
            </div>

            <!-- Active chat interface -->
            <div id="chat-view" class="hidden flex-col flex-grow h-full">
                <!-- Chat header -->
                <header class="p-4 flex items-center justify-between space-x-4 flex-shrink-0 glassmorphism rounded-t-xl border-b border-slate-200/20 dark:border-slate-700/30">
                    <div class="flex items-center space-x-4 min-w-0">
                        <div id="chat-header-avatar" class="w-12 h-12 rounded-full flex items-center justify-center font-bold text-white text-xl flex-shrink-0 shadow-lg"></div>
                        <div class="min-w-0">
                            <h2 id="chat-header-name" class="text-lg font-bold text-slate-900 dark:text-slate-100 truncate"></h2>
                            <p id="chat-header-status" class="text-sm font-mono opacity-80 truncate"></p>
                        </div>
                    </div>
                    <button id="close-chat-btn" title="Close Chat" class="p-2 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-200/50 dark:hover:bg-slate-700/50 transition-colors flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </header>

                <!-- Message history -->
                <div id="messages-container" class="flex-grow p-4 overflow-y-auto space-y-3"></div>

                <!-- Quick reply suggestions -->
                <div id="ai-suggestions-container" class="px-6 pb-2 flex items-center gap-2 flex-wrap"></div>

                <!-- File attachment preview -->
                <div id="file-preview-container" class="px-4 pb-2 hidden">
                    <div id="file-preview" class="p-2 bg-slate-200/50 dark:bg-slate-900/50 rounded-xl flex flex-wrap gap-2 max-h-28 overflow-y-auto backdrop-blur-sm"></div>
                </div>

                <!-- Message input area -->
                <footer class="p-4 flex-shrink-0">
                    <div id="quote-preview-container" class="hidden p-2 mx-1 mb-1 bg-slate-200/50 dark:bg-slate-900/30 rounded-lg"></div>
                    <form id="message-form" class="relative">
                        <div class="relative glassmorphism rounded-2xl shadow-lg overflow-hidden">
                            <!-- Attachment button -->
                            <button type="button" id="attachment-btn" class="absolute left-3 bottom-3 p-1.5 text-slate-500 dark:text-slate-400 hover:text-teal-500 dark:hover:text-teal-400 transition-all duration-300 transform hover:scale-110 flex-shrink-0 rounded-lg hover:bg-slate-200/30 dark:hover:bg-slate-700/30 z-10" title="Attach files">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                                </svg>
                            </button>
                            
                            <!-- Message textarea -->
                            <textarea id="message-input" 
                                      rows="1" 
                                      placeholder="Type a message..."
                                      style="color: white !important;"
                                      class="w-full bg-transparent focus:outline-none text-base py-3 pl-12 pr-12 resize-none overflow-y-hidden min-h-[3rem] max-h-32 border-0"
                            ></textarea>
                            
                            <!-- Send button -->
                            <button type="submit" id="send-btn" class="absolute right-3 bottom-3 p-1.5 transition-all duration-300 transform flex-shrink-0 rounded-lg hover:bg-slate-200/20 dark:hover:bg-slate-700/20 z-10" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 send-icon" viewBox="0 0 24 24">
                                    <defs>
                                        <linearGradient id="send-icon-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" class="grad-start" />
                                            <stop offset="100%" class="grad-end" />
                                        </linearGradient>
                                    </defs>
                                    <path fill="url(#send-icon-gradient)" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                                </svg>
                            </button>
                        </div>
                    </form>
                </footer>
            </div>
        </main>
    </div>

    <!-- Hidden file input for attachments -->
    <input type="file" id="file-input" multiple class="hidden">

    <!-- Conversation summary modal -->
    <div id="summary-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-slate-100 dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col glassmorphism transform transition-all duration-300 scale-95 opacity-0">
            <h2 class="text-xl font-bold text-slate-900 dark:text-white p-6 border-b border-slate-200/20 dark:border-slate-700/30 flex-shrink-0 flex items-center gap-2">
                <span class="text-2xl">✨</span> Conversation Summary
            </h2>
            <div id="summary-content" class="p-6 overflow-y-auto text-slate-700 dark:text-slate-300 space-y-4"></div>
            <div class="p-4 border-t border-slate-200/20 dark:border-slate-700/30 flex-shrink-0 flex justify-end">
                <button id="close-summary-btn" class="px-5 py-2 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white transition-all duration-300 transform hover:scale-105 shadow-lg">Close</button>
            </div>
        </div>
    </div>

    <!-- Settings modal -->
    <div id="settings-modal" class="fixed inset-0 z-[10000] flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-white/80 dark:bg-slate-800/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-2xl flex flex-col glassmorphism transform transition-all duration-300 scale-95 opacity-0 border border-white/20">
            <!-- Header -->
            <div class="p-6 border-b border-slate-200/50 dark:border-slate-700/50 flex-shrink-0 flex justify-between items-center bg-white/50 dark:bg-slate-800/50 rounded-t-3xl">
                <h2 class="text-xl font-bold text-slate-900 dark:text-white flex items-center gap-3">
                    <span class="text-2xl">⚙️</span>
                    <span>Settings</span>
                </h2>
                <button id="close-settings-btn" class="p-2 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-200/50 dark:hover:bg-slate-700/50 transition-all duration-300 hover:rotate-90">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Content Grid: Three Columns to fit everything without vertical scrolling -->
            <div class="px-6 py-4 overflow-y-hidden grid grid-cols-1 md:grid-cols-3 gap-6 text-slate-600 dark:text-slate-300">
                
                <!-- Column 1: Identity -->
                <div class="space-y-4">
                    <h3 class="text-[11px] font-bold text-teal-600 dark:text-teal-400 uppercase tracking-widest border-b border-teal-500/20 pb-1.5">Profile</h3>
                    
                    <div class="flex flex-col items-center p-3 bg-slate-50/50 dark:bg-slate-900/30 rounded-xl border border-slate-200/50 dark:border-slate-700/30">
                        <div class="relative group">
                            <img id="settings-pfp-preview" src="placeholder.png" class="h-16 w-16 rounded-full bg-slate-200 dark:bg-slate-700 object-cover border-2 border-white dark:border-gray-800 shadow shadow-teal-500/10 transition-transform duration-300 group-hover:scale-105">
                            <button id="pfp-select-btn" type="button" class="absolute -bottom-1 -right-1 p-1.5 rounded-full bg-teal-500 text-white shadow-lg border-2 border-white dark:border-slate-800 hover:bg-teal-600 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                            </button>
                            <input type="file" id="pfp-file-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                        </div>
                    </div>

                    <div class="space-y-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1 ml-1">Display Name</label>
                            <input type="text" id="settings-displayname" class="w-full px-2.5 py-1.5 text-xs rounded-lg bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 outline-none focus:ring-1 focus:ring-teal-500 transition-all" placeholder="Name">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1 ml-1">Username (@)</label>
                            <input type="text" id="settings-username" class="w-full px-2.5 py-1.5 text-xs rounded-lg bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 outline-none focus:ring-1 focus:ring-teal-500 transition-all" placeholder="Unique ID">
                        </div>
                    </div>
                </div>

                <!-- Column 2: Appearance -->
                <div class="space-y-4">
                    <h3 class="text-[11px] font-bold text-purple-600 dark:text-purple-400 uppercase tracking-widest border-b border-purple-500/20 pb-1.5">Appearance</h3>
                    
                    <div class="space-y-2.5 p-3 bg-slate-50/50 dark:bg-slate-900/30 rounded-xl border border-slate-200/50 dark:border-slate-700/30">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1">App Font</label>
                            <select id="settings-app-font" class="w-full p-2 text-[11px] rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 outline-none text-slate-800 dark:text-slate-200 cursor-pointer shadow-sm">
                                <option value="'Inter', sans-serif">Inter (Clean)</option>
                                <option value="'Roboto', sans-serif">Roboto</option>
                                <option value="'Montserrat', sans-serif">Montserrat</option>
                                <option value="'Space Grotesk', sans-serif">Space Tech</option>
                                <option value="'Comic Sans MS', cursive">Comic Sans</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1">Chat Font</label>
                            <select id="settings-chat-font" class="w-full p-2 text-[11px] rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 outline-none text-slate-800 dark:text-slate-200 cursor-pointer shadow-sm">
                                <option value="'Inter', sans-serif">Inter (Clean)</option>
                                <option value="'Roboto Mono', monospace">Roboto Mono</option>
                                <option value="'Fira Code', monospace">Fira Code</option>
                                <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
                                <option value="'Space Grotesk', sans-serif">Space Tech</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-1 px-1">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Scale</label>
                            <span id="font-size-value" class="text-[10px] font-bold font-mono text-purple-600 bg-purple-100 dark:bg-purple-900/40 px-1.5 rounded">100%</span>
                        </div>
                        <input type="range" id="font-size-slider" min="50" max="200" step="10" value="100" class="w-full h-1.5 rounded-lg appearance-none bg-slate-200 dark:bg-slate-700 accent-purple-500 cursor-pointer">
                    </div>
                </div>

                <!-- Column 3: Connection -->
                <div class="space-y-4">
                    <h3 class="text-[11px] font-bold text-blue-600 dark:text-blue-400 uppercase tracking-widest border-b border-blue-500/20 pb-1.5">Network</h3>
                    
                    <div class="bg-slate-50/50 dark:bg-slate-900/30 p-2.5 rounded-xl border border-slate-200/50 dark:border-slate-700/30">
                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 ml-1">Connection Mode</label>
                        <div class="relative bg-white dark:bg-slate-800 p-0.5 rounded-lg flex border border-slate-200 dark:border-slate-700/50 h-8">
                            <div id="conn-indicator" class="absolute top-0.5 left-0.5 bottom-0.5 w-[calc(50%-2px)] bg-slate-100 dark:bg-slate-700 rounded-md shadow transition-all duration-300 z-0"></div>
                            <button type="button" id="set-lan-mode" class="flex-1 text-[10px] font-bold z-10 transition-colors text-teal-600 dark:text-teal-400 outline-none">LAN</button>
                            <button type="button" id="set-online-mode" class="flex-1 text-[10px] font-bold z-10 transition-colors text-slate-500 dark:text-slate-400 outline-none">ONLINE</button>
                        </div>
                        <p id="conn-description" class="mt-2 text-[8.5px] text-center text-slate-400 uppercase tracking-tight opacity-70">Local network discovery Mode</p>
                    </div>

                    <div class="p-3 bg-slate-50/50 dark:bg-slate-900/30 rounded-xl border border-slate-200/50 dark:border-slate-700/30">
                        <div class="flex items-center justify-between">
                            <span class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Auto-Download</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="settings-auto-download" class="sr-only peer">
                                <div class="w-8 h-4 bg-slate-300 dark:bg-slate-600 rounded-full peer peer-checked:bg-teal-500 transition-all after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:after:translate-x-4 shadow-inner"></div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer: Actions -->
            <div class="px-6 py-4 border-t border-slate-200/50 dark:border-slate-700/50 flex flex-shrink-0 justify-end gap-3 bg-slate-50/50 dark:bg-slate-800/30 rounded-b-3xl">
                <button id="cancel-settings-btn" class="px-4 py-2 rounded-lg text-xs font-bold text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition-all">Cancel</button>
                <button id="save-settings-btn" class="px-8 py-2 rounded-lg text-xs font-bold text-white bg-gradient-to-r from-teal-500 to-blue-500 hover:from-teal-600 hover:to-blue-600 shadow-md hover:shadow-teal-500/20 transform hover:-translate-y-0.5 active:translate-y-0 transition-all">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Right-click context menu for messages -->
    <div id="message-context-menu" class="hidden absolute z-50 bg-slate-200/80 dark:bg-slate-700/80 backdrop-blur-md rounded-lg shadow-xl p-2 min-w-[150px]">
        <ul class="space-y-1">
            <li>
                <button id="quote-reply-btn" class="w-full flex items-center gap-3 text-left px-3 py-1.5 rounded-md text-sm text-slate-800 dark:text-slate-200 hover:bg-teal-500/20 hover:text-teal-600 dark:hover:text-teal-400 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" /></svg>
                    <span>Quote Reply</span>
                </button>
            </li>
        </ul>
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>